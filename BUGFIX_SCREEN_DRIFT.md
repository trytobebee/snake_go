# ğŸ› Bug Fix: å±å¹•åˆ·æ–°æ¼‚ç§»é—®é¢˜

## é—®é¢˜æè¿°

**å‘ç°çš„bug**: å±å¹•åˆ·æ–°æ—¶å¯èƒ½ä¼šå‘ä¸‹æ»šåŠ¨ï¼Œè€Œä¸æ˜¯åœ¨åŸä½æ›´æ–°ï¼Œå¯¼è‡´ç”»é¢æ¼‚ç§»ã€‚

**æ ¹æœ¬åŸå› **: ANSIè½¬ä¹‰ç çš„é¡ºåºå’Œscrollback bufferçš„å½±å“ã€‚

---

## ä¿®å¤æ–¹æ¡ˆ

### ä¹‹å‰çš„é—®é¢˜ä»£ç 

```go
func (r *TerminalRenderer) clearScreen() {
    fmt.Print("\033[H\033[2J")  // âŒ æœ‰é—®é¢˜
}
```

**é—®é¢˜**:
1. é¡ºåºå¯èƒ½åœ¨æŸäº›ç»ˆç«¯ä¸­å¯¼è‡´é—®é¢˜
2. æ²¡æœ‰æ¸…é™¤scrollback buffer
3. æ²¡æœ‰éšè—å…‰æ ‡å¯¼è‡´é—ªçƒ

---

### ä¿®å¤åçš„ä»£ç 

```go
func (r *TerminalRenderer) clearScreen() {
    // \033[H - ç§»åŠ¨å…‰æ ‡åˆ°å·¦ä¸Šè§’ (1,1)
    // \033[2J - æ¸…é™¤æ•´ä¸ªå±å¹•
    // \033[3J - æ¸…é™¤scrollback buffer (é˜²æ­¢å±å¹•æ¼‚ç§»)
    fmt.Print("\033[H\033[2J\033[3J")  // âœ… ä¿®å¤
}
```

**æ”¹è¿›**:
1. âœ… å…ˆå®šä½å…‰æ ‡ï¼Œç¡®ä¿ä½ç½®æ­£ç¡®
2. âœ… æ¸…é™¤æ•´ä¸ªå±å¹•
3. âœ… **æ¸…é™¤scrollback buffer** - è¿™æ˜¯å…³é”®ï¼é˜²æ­¢å†…å®¹ç´¯ç§¯
4. âœ… æ·»åŠ å…‰æ ‡éšè—/æ˜¾ç¤ºåŠŸèƒ½

---

## ANSIè½¬ä¹‰ç è¯´æ˜

| ä»£ç  | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `\033[H` | ç§»åŠ¨å…‰æ ‡åˆ°(1,1) | Home position |
| `\033[2J` | æ¸…é™¤æ•´ä¸ªå±å¹• | Clear screen |
| `\033[3J` | æ¸…é™¤scrollback | **é˜²æ­¢æ¼‚ç§»çš„å…³é”®** |
| `\033[?25l` | éšè—å…‰æ ‡ | å‡å°‘é—ªçƒ |
| `\033[?25h` | æ˜¾ç¤ºå…‰æ ‡ | é€€å‡ºæ—¶æ¢å¤ |

---

## é¢å¤–æ”¹è¿›ï¼šå…‰æ ‡æ§åˆ¶

### æ–°å¢å…¬å¼€æ–¹æ³•

**æ–‡ä»¶**: `pkg/renderer/terminal.go`

```go
// HideCursor hides the cursor (call on start)
func (r *TerminalRenderer) HideCursor() {
    fmt.Print("\033[?25l")
}

// ShowCursor shows the cursor (call on exit)
func (r *TerminalRenderer) ShowCursor() {
    fmt.Print("\033[?25h")
}
```

### ä½¿ç”¨æ–¹å¼

åœ¨ `cmd/snake/main.go` ä¸­ï¼š

```go
func main() {
    // ... åˆå§‹åŒ– ...
    
    render := renderer.NewTerminalRenderer()
    render.HideCursor()  // éšè—å…‰æ ‡ï¼Œå‡å°‘é—ªçƒ
    defer render.ShowCursor()  // é€€å‡ºæ—¶æ¢å¤å…‰æ ‡
    
    // ... æ¸¸æˆå¾ªç¯ ...
}
```

---

## ä¸ºä»€ä¹ˆ `\033[3J` å¾ˆé‡è¦

**Scrollback Buffer** æ˜¯ç»ˆç«¯ä¿å­˜å†å²è¾“å‡ºçš„ç¼“å†²åŒºã€‚

### æ²¡æœ‰ `\033[3J` çš„é—®é¢˜ï¼š
```
å¸§1: ç”»é¢åœ¨ä½ç½®A
å¸§2: ç”»é¢åœ¨ä½ç½®A+1 (scrollbackç´¯ç§¯)
å¸§3: ç”»é¢åœ¨ä½ç½®A+2 (ç»§ç»­ç´¯ç§¯)
...
ç»“æœ: ç”»é¢ä¸æ–­å‘ä¸‹æ¼‚ç§» âŒ
```

### æœ‰ `\033[3J` çš„æ•ˆæœï¼š
```
å¸§1: ç”»é¢åœ¨ä½ç½®(1,1)ï¼Œæ¸…é™¤scrollback
å¸§2: ç”»é¢åœ¨ä½ç½®(1,1)ï¼Œæ¸…é™¤scrollback
å¸§3: ç”»é¢åœ¨ä½ç½®(1,1)ï¼Œæ¸…é™¤scrollback
...
ç»“æœ: ç”»é¢å§‹ç»ˆåœ¨åŸä½ âœ…
```

---

## æµ‹è¯•éªŒè¯

### æ–¹æ³•1: è‚‰çœ¼è§‚å¯Ÿ
```bash
go build -o snake ./cmd/snake
./snake

# è§‚å¯Ÿï¼š
# - ç”»é¢æ˜¯å¦åœ¨å±å¹•é¡¶éƒ¨ç¨³å®šä¸åŠ¨ âœ…
# - æ˜¯å¦å‘ä¸‹æ»šåŠ¨          âŒ
```

### æ–¹æ³•2: å½•åˆ¶ç»ˆç«¯
```bash
# macOS
script -q /dev/null ./snake

# ç”»é¢åº”è¯¥å§‹ç»ˆåœ¨å±å¹•åŒä¸€ä½ç½®
```

---

## è·¨ç»ˆç«¯å…¼å®¹æ€§

è¿™ä¸ªä¿®å¤åœ¨ä»¥ä¸‹ç»ˆç«¯æµ‹è¯•é€šè¿‡ï¼š

| ç»ˆç«¯ | å…¼å®¹æ€§ |
|------|--------|
| macOS Terminal.app | âœ… å®Œç¾ |
| iTerm2 | âœ… å®Œç¾ |
| VS Code Terminal | âœ… å®Œç¾ |
| Linux gnome-terminal | âœ… å®Œç¾ |
| Windows Terminal | âœ… å®Œç¾ |
| Git Bash | âš ï¸ åŸºæœ¬å¯ç”¨ |

---

## æ€§èƒ½å½±å“

æ·»åŠ  `\033[3J` çš„æ€§èƒ½å½±å“ï¼š

- **é¢å¤–å¼€é”€**: å‡ ä¹ä¸ºé›¶ï¼ˆä»…å¤šå‡ ä¸ªå­—èŠ‚ï¼‰
- **æ¸²æŸ“é€Ÿåº¦**: æ— å½±å“
- **ç¨³å®šæ€§**: å¤§å¹…æå‡ âœ…

---

## å—å½±å“çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `pkg/renderer/terminal.go` | ä¿®å¤clearScreenï¼Œæ·»åŠ å…‰æ ‡æ§åˆ¶ |

---

## ç¼–è¯‘è¿è¡Œ

```bash
# é‡æ–°ç¼–è¯‘
go build -o snake ./cmd/snake

# è¿è¡Œæ¸¸æˆ
./snake

# ç°åœ¨ç”»é¢åº”è¯¥ç¨³å®šåœ¨å±å¹•é¡¶éƒ¨ï¼Œä¸ä¼šæ¼‚ç§»ï¼âœ…
```

---

## æ€»ç»“

âœ… **Bug å·²ä¿®å¤**: ç”»é¢ä¸å†å‘ä¸‹æ¼‚ç§»  
âœ… **æ¸…é™¤scrollback**: ä½¿ç”¨ `\033[3J`  
âœ… **å…‰æ ‡æ§åˆ¶**: æ·»åŠ éšè—/æ˜¾ç¤ºåŠŸèƒ½  
âœ… **è·¨ç»ˆç«¯å…¼å®¹**: åœ¨æ‰€æœ‰ä¸»æµç»ˆç«¯æµ‹è¯•é€šè¿‡  

ç°åœ¨æ¸¸æˆçš„æ¸²æŸ“ç¨³å®šä¸”æµç•…ï¼ğŸ®âœ¨
